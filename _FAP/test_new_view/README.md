# Pear Child View Demo

A clean, simple demonstration of creating child views in Pear applications.

## Overview

This demo shows how to create child views using Pear's direct IPC approach. The code is organized into separate modules for clarity and reusability.

## Files

- **`index.html`** - Main application window
- **`app.js`** - Main application logic with UI event handlers
- **`create-child-view.js`** - Child view creation utilities (reusable module)
- **`child-view.html`** - Child view content
- **`package.json`** - Pear application configuration

## How It Works

### Creating Child Views

The `createChildView()` function handles all the complexity:

```javascript
import { createChildView, ChildViewManager } from "./create-child-view.js";

// Create a child view
const viewId = await createChildView("child-view.html", {
  width: 350,
  height: 250,
  x: 100,
  y: 100,
});

// Manage the view
const childView = new ChildViewManager(viewId);
await childView.show();
await childView.hide();
await childView.close();
```

### State Object Structure

The state object contains only the required properties (NO manual `id`):

```javascript
const state = {
  sidecar: sidecarUrl, // HTTP endpoint
  config: config, // Pear config
  key: config.key, // App key
  dir: config.dir, // App directory
  options: config.options || {}, // Additional options
  // ❌ NO manual id property!
};
```

### View ID Generation

View IDs are automatically generated by Pear using Electron's `webContents.id`:

```javascript
// From gui/gui.js
const idify = (instance) => {
  const { view, win } = instance;
  const { webContents } = view || win;
  return webContents.id; // <- Electron-generated ID
};
```

## Key Features

- ✅ **Clean separation of concerns** - UI logic separate from view creation
- ✅ **Reusable module** - `create-child-view.js` can be used in other projects
- ✅ **Proper state construction** - No manual ID assignment
- ✅ **Complete view management** - Create, show, hide, close
- ✅ **Error handling** - Graceful error messages
- ✅ **Simple UI** - Clean, minimal interface

## Running the Demo

```bash
cd _FAP/test_new_view
pear run -d .
```

## Critical Rules

### ❌ NEVER Do This:

```javascript
const state = {
  id: "manual-id", // WRONG! This breaks everything
  // ...
};
```

### ✅ ALWAYS Do This:

```javascript
const state = {
  sidecar: sidecarUrl,
  config: config,
  key: config.key,
  dir: config.dir,
  options: config.options || {},
  // No manual id property!
};
```

## Architecture

- **Parent Window**: Electron BrowserWindow containing the main UI
- **Child Views**: Electron BrowserView instances attached to the parent
- **IPC Communication**: Direct calls to Pear's internal GUI system
- **ID Management**: Automatic generation using Electron's WebContents IDs

This demo provides a solid foundation for building Pear applications with multiple views.
